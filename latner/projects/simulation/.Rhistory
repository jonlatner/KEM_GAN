library(mlogit)
set.seed(123)  # set to NA if you want different random draws every run
options(scipen=999)
# --- Step 1: Define structure ---
workers <- 1:10
occupations <- c("A", "B") # A = low-wage, B = high-wage
periods <- 1:3
# --- Step 2: Observed histories ---
obs_data <- expand.grid(worker = workers, period = periods) %>%
group_by(worker) %>%
mutate(occ_actual = case_when(
period == 1 ~ "A",                # everyone starts in low-wage A
TRUE ~ sample(occupations, 1)     # some stay, some move to B
)) %>%
ungroup()
# Assign wage status (rule: A = low, B = high, but allow "promotion in place")
obs_data <- obs_data %>%
group_by(worker) %>%
mutate(low_wage = ifelse(occ_actual == "A", 1, 0),
# some A-workers switch to high wages after period 1
low_wage = ifelse(occ_actual == "A" & period > 1 & runif(n()) < 0.3, 0, low_wage)) %>%
ungroup() %>%
arrange(worker, period)
print(obs_data)
# --- Step 3: Plot worker trajectories ---
plot <- ggplot(obs_data, aes(x = period, y = factor(worker),
color = occ_actual, shape = factor(low_wage))) +
geom_line(aes(group = worker), color = "grey70") +
geom_point(size = 4) +
scale_color_manual(values = c("A" = "steelblue", "B" = "darkorange")) +
scale_shape_manual(values = c("1" = 16, "0" = 17),
labels = c("High wage", "Low wage")) +
labs(x = "Period", y = "Worker",
color = "Occupation", shape = "Wage status",
title = "Worker occupation and wage status over time") +
theme_minimal()
print(plot)
# Flag whether worker is in high wage status
obs_data <- obs_data %>%
mutate(high_wage = ifelse(low_wage == 0, 1, 0))
# Identify type of transition
obs_data <- obs_data %>%
mutate(transition_type = case_when(
period == 1 ~ "Baseline",
occ_actual == "B" & high_wage == 1 ~ "Occ -> High-wage (A→B)",
occ_actual == "A" & high_wage == 1 ~ "In-place High-wage (A→A)",
TRUE ~ "Remain Low-wage"
))
# Aggregate: average number of workers in each category by period
transitions_summary <- obs_data %>%
filter(period > 1) %>%   # exclude baseline
group_by(period, transition_type) %>%
summarise(n_workers = n(), .groups = "drop")
print(transitions_summary)
# --- Step 10: Plot descriptive transitions ---
ggplot(transitions_summary, aes(x = factor(period), y = n_workers, fill = transition_type)) +
geom_col(position = "dodge") +
labs(x = "Period", y = "Number of workers",
title = "Average number of workers transitioning out of low-wage",
fill = "Transition type") +
theme_minimal()
# --- Step 4: Expand into choice sets ---
choice_data <- obs_data %>%
rename(occ_origin = occ_actual) %>%
left_join(expand.grid(dest = occupations, period = periods), by = "period") %>%
group_by(worker, period) %>%
mutate(chosen = ifelse(occ_origin == dest, 1, 0)) %>%
ungroup() %>%
arrange(worker, period, dest)
# --- Step 5: Similarity matrix ---
similarity_mat <- expand.grid(origin = occupations, dest = occupations) %>%
mutate(similarity = case_when(
origin == dest ~ 1,              # staying
origin == "A" & dest == "B" ~ 0.5,  # low → high
origin == "B" & dest == "A" ~ 0.5   # high → low
))
choice_data <- choice_data %>%
left_join(similarity_mat, by = c("occ_origin" = "origin", "dest" = "dest"))
# --- Step 6: Add experience in the origin occupation ---
choice_data <- choice_data %>%
group_by(worker, occ_origin) %>%
mutate(exp_origin = row_number() - 1) %>%
ungroup() %>%
arrange(worker, period, dest)
print(choice_data)
# --- Step 7: Add choice situation ID ---
choice_data <- choice_data %>%
mutate(choice_id = paste(worker, period, sep = "_"))
# --- Step 8: Convert to mlogit.data ---
mlogit_df <- mlogit.data(choice_data,
choice = "chosen",
shape = "long",
alt.var = "dest",
chid.var = "choice_id",
id.var = "worker")
# --- Step 9: Estimate MCL model ---
model <- mlogit(chosen ~ similarity + exp_origin | 0, data = mlogit_df)
summary(model)
View(choice_data)
# Top commands ----
# Create empty R application (no figures, data frames, packages, etc.)
# Get a list of all loaded packages
packages <- search()[grepl("package:", search())]
# Unload each package
for (package in packages) {
unloadNamespace(package)
}
rm(list=ls(all=TRUE))
# load library
library(synthpop)
library(tidyverse)
library(xtable)
# FOLDERS - ADAPT THIS PATHWAY
main_dir = "/Users/jonathanlatner/Documents/GitHub/KEM_GAN/latner/projects/simulation/"
data_files = "data_files/"
original_data = "data_files/original/"
synthetic_data = "data_files/synthetic/synthpop/"
graphs = "graphs/"
tables = "tables/"
setwd(main_dir)
#functions
options(scipen=999)
# Load data ----
ods <- SD2011[, c("sex", "age", "region","placesize","depress")]
# original ----
s5 <- syn(ods, seed = 8564, m = 5, print.flag = FALSE)
t5 <- disclosure( s5, ods, keys = c("sex", "age", "region", "placesize"), target = "depress", print.flag = FALSE)
ttest1 <- print(t5, to.print = "allCAPs")
repU <- t5$ident$repU
average_row <- mean(repU) # calculate average row across 10 synthetic data sets
repU <- c(t5$ident$UiO[1], repU, average_row)
DiSCO <- t5$attrib$DiSCO
average_row <- mean(DiSCO) # calculate average row across 10 synthetic data sets
DiSCO <- c(t5$attrib$Dorig[1], DiSCO, average_row)
# create table
df_risk_1 <- data.frame(
data = c("Original data", "Synthetic 1", "Synthetic 2", "Synthetic 3", "Synthetic 4", "Synthetic 5", "Average"),
identity = c(repU),
attribute = c(DiSCO)
)
# Create the xtable object
latex_table <- xtable(df_risk_1,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
# include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_disclosure_risk_sd2011_original.tex"))
# modified ----
s6 <- s5
for (c in 1:5) {
sds <- data.frame(s5$syn[c])
sds$depress <- 0
s6$syn[[c]] <- sds
}
t6 <- disclosure( s6, ods, keys = c("sex", "age", "region", "placesize"), target = "depress", print.flag = FALSE)
ttest2 <- print(t6, to.print = "allCAPs")
repU <- t6$ident$repU
average_row <- mean(repU) # calculate average row across 10 synthetic data sets
repU <- c(t6$ident$UiO[1], repU, average_row)
DiSCO <- t6$attrib$DiSCO
average_row <- mean(DiSCO) # calculate average row across 10 synthetic data sets
DiSCO <- c(t6$attrib$Dorig[1], DiSCO, average_row)
# create table
df_risk_2 <- data.frame(
data = c("Original data", "Synthetic 1", "Synthetic 2", "Synthetic 3", "Synthetic 4", "Synthetic 5", "Average"),
identity = c(repU),
attribute = c(DiSCO)
)
# Create the xtable object
latex_table <- xtable(df_risk_2,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
# include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
sanitize.text.function = identity,
file = paste0(tables,"table_disclosure_risk_sd2011_modified.tex"))
# combine ----
df_risk_1$type <- "Original"
df_risk_2$type <- "Modified"
df_risk <- rbind(df_risk_1,df_risk_2) %>%
pivot_longer(!c(data,type)) %>%
pivot_wider(names_from = c(name, type), values_from = c(value)) %>%
select(data, identity_Original, identity_Modified, attribute_Original, attribute_Modified)
df_risk
columns_header_top <- c("
\\toprule &
\\multicolumn{2}{l}{Identity risk ($repU$)} &
\\multicolumn{2}{l}{Attribute risk ($DiSCO$)}
\\\\  \n
\\cmidrule(lr){2-3}
\\cmidrule(lr){4-5}
")
columns_header_mid <- c("
Data & Raab et al., 2024 & Modified & Raab et al., 2024 & Modified
\\\\ \n
\\midrule
")
notes <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{5}{p{5in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{5}{p{4in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrrrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes)),
file = paste0(tables,"table_disclosure_risk_sd2011.tex"))
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_v2.tex"))
ttest1$allCAPs
ttest2$allCAPs
# DISCO ----
df_risk_1$type <- "Original"
df_risk_2$type <- "Modified"
df_risk <- rbind(df_risk_1,df_risk_2) %>%
pivot_longer(!c(data,type)) %>%
pivot_wider(names_from = c(name, type), values_from = c(value)) %>%
select(data, identity_Original, identity_Modified, attribute_Original, attribute_Modified)
df_risk
# Top commands ----
# Create empty R application (no figures, data frames, packages, etc.)
# Get a list of all loaded packages
packages <- search()[grepl("package:", search())]
# Unload each package
for (package in packages) {
unloadNamespace(package)
}
rm(list=ls(all=TRUE))
# load library
library(synthpop)
library(tidyverse)
library(xtable)
# FOLDERS - ADAPT THIS PATHWAY
main_dir = "/Users/jonathanlatner/Documents/GitHub/KEM_GAN/latner/projects/simulation/"
data_files = "data_files/"
original_data = "data_files/original/"
synthetic_data = "data_files/synthetic/synthpop/"
graphs = "graphs/"
tables = "tables/"
setwd(main_dir)
#functions
options(scipen=999)
# Load data ----
ods <- SD2011[, c("sex", "age", "region","placesize","depress")]
# original ----
s5 <- syn(ods, seed = 8564, m = 5, print.flag = FALSE)
t5 <- disclosure( s5, ods, keys = c("sex", "age", "region", "placesize"), target = "depress", print.flag = FALSE)
ttest1 <- print(t5, to.print = "allCAPs")
repU <- t5$ident$repU
average_row <- mean(repU) # calculate average row across 10 synthetic data sets
repU <- c(t5$ident$UiO[1], repU, average_row)
DiSCO <- t5$attrib$DiSCO
average_row <- mean(DiSCO) # calculate average row across 10 synthetic data sets
DiSCO <- c(t5$attrib$Dorig[1], DiSCO, average_row)
# create table
df_risk_1 <- data.frame(
data = c("Original data", "Synthetic 1", "Synthetic 2", "Synthetic 3", "Synthetic 4", "Synthetic 5", "Average"),
identity = c(repU),
attribute = c(DiSCO)
)
# Create the xtable object
latex_table <- xtable(df_risk_1,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
# include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_disclosure_risk_sd2011_original.tex"))
# modified ----
s6 <- s5
for (c in 1:5) {
sds <- data.frame(s5$syn[c])
sds$depress <- 0
s6$syn[[c]] <- sds
}
t6 <- disclosure( s6, ods, keys = c("sex", "age", "region", "placesize"), target = "depress", print.flag = FALSE)
ttest2 <- print(t6, to.print = "allCAPs")
repU <- t6$ident$repU
average_row <- mean(repU) # calculate average row across 10 synthetic data sets
repU <- c(t6$ident$UiO[1], repU, average_row)
DiSCO <- t6$attrib$DiSCO
average_row <- mean(DiSCO) # calculate average row across 10 synthetic data sets
DiSCO <- c(t6$attrib$Dorig[1], DiSCO, average_row)
# create table
df_risk_2 <- data.frame(
data = c("Original data", "Synthetic 1", "Synthetic 2", "Synthetic 3", "Synthetic 4", "Synthetic 5", "Average"),
identity = c(repU),
attribute = c(DiSCO)
)
# Create the xtable object
latex_table <- xtable(df_risk_2,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
# include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
sanitize.text.function = identity,
file = paste0(tables,"table_disclosure_risk_sd2011_modified.tex"))
# combine ----
df_risk_1$type <- "Original"
df_risk_2$type <- "Modified"
df_risk <- rbind(df_risk_1,df_risk_2) %>%
pivot_longer(!c(data,type)) %>%
pivot_wider(names_from = c(name, type), values_from = c(value)) %>%
select(data, identity_Original, identity_Modified, attribute_Original, attribute_Modified)
df_risk
columns_header_top <- c("
\\toprule &
\\multicolumn{2}{l}{Identity risk ($repU$)} &
\\multicolumn{2}{l}{Attribute risk ($DiSCO$)}
\\\\  \n
\\cmidrule(lr){2-3}
\\cmidrule(lr){4-5}
")
columns_header_mid <- c("
Data & Raab et al., 2024 & Modified & Raab et al., 2024 & Modified
\\\\ \n
\\midrule
")
notes <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{5}{p{5in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{5}{p{4in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrrrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes)),
file = paste0(tables,"table_disclosure_risk_sd2011.tex"))
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_v2.tex"))
ttest1$allCAPs
ttest2$allCAPs
# DISCO ----
df_risk_1$type <- "Original"
df_risk_2$type <- "Modified"
df_risk <- rbind(df_risk_1,df_risk_2) %>%
pivot_longer(!c(data,type)) %>%
pivot_wider(names_from = c(name, type), values_from = c(value)) %>%
select(data, attribute_Original, attribute_Modified)
df_risk
columns_header_top <- c("
\\toprule &
\\multicolumn{2}{l}{Attribute risk ($DiSCO$)}
\\\\  \n
\\cmidrule(lr){4-5}
")
columns_header_mid <- c("
Data & Raab et al., 2024 & Modified
\\\\ \n
\\midrule
")
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{3}{p{4in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_disco.tex"))
ttest1$allCAPs
ttest2$allCAPs
columns_header_top <- c("
\\toprule &
\\multicolumn{2}{l}{Attribute risk ($DiSCO$)}
\\\\  \n
\\cmidrule(lr){3-4}
")
columns_header_mid <- c("
Data & Raab et al., 2024 & Modified
\\\\ \n
\\midrule
")
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{3}{p{4in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_disco.tex"))
columns_header_top <- c("
\\toprule &
\\multicolumn{2}{l}{Attribute risk ($DiSCO$)}
\\\\  \n
\\cmidrule(lr){2-3}
")
columns_header_mid <- c("
Data & Raab et al., 2024 & Modified
\\\\ \n
\\midrule
")
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{3}{p{4in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_disco.tex"))
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{3}{p{3in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_disco.tex"))
notes_2 <- c("\\bottomrule \\\\[-1.8ex] \\multicolumn{3}{p{2in}}{Note: Modified indicates that values of \\texttt{depress}=0 for all records in the synthetic data} \n")
# Create the xtable object
latex_table <- xtable(df_risk,align = "llrr")
print.xtable(latex_table,
include.rownames = FALSE,
include.colnames = FALSE,
floating = FALSE,
booktabs = TRUE,
hline.after = NULL,
sanitize.text.function = identity,
add.to.row = list(
pos = list(0,0,1,6,7),
command = c(columns_header_top,
columns_header_mid,
"\\midrule\n",   # midrule on line 6
"\\midrule\n",   # midrule on line 6
notes_2)),
file = paste0(tables,"table_disclosure_risk_sd2011_disco.tex"))
