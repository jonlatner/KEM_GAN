# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_ds_ctgan_nofriend_1.pdf"), height = 4, width = 10)
df_compare_1_ds <- rbind(sds_datasynthesizer,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value<=30 | is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend<=30")
df_compare_2_ds <- rbind(sds_datasynthesizer,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value>30) %>%
mutate(value = as.factor(value),
sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend>30")
df_compare_1_ctgan <- rbind(sds_ctgan,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value<=30 | is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend<=30")
df_compare_2_ctgan <- rbind(sds_ctgan,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value>30) %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend>30")
df_compare_1_synthpop <- rbind(sds_synthpop,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value<=30 | is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend<=30")
df_compare_2_synthpop <- rbind(sds_synthpop,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(value>30) %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nofriend>30")
df_compare <- rbind(df_compare_1_synthpop, df_compare_2_synthpop,df_compare_1_ds, df_compare_2_ds,df_compare_1_ctgan,df_compare_2_ctgan)
# df_compare <- rbind(df_compare_1_ds, df_compare_2_ds)
df_graph <- ggplot(df_compare, aes(x = as.numeric(value), y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~type+sdg, scales = "free") +
theme_bw() +
# scale_x_discrete(breaks = c("0","10","20","30","31","40","50","60","70","80","99","100",NA)) +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_nofriend_1.pdf"), height = 4, width = 10)
# Graph (bmi) ----
ods <- data.frame(with(df_ods,table(bmi,useNA = "ifany")))
names(ods)[1:2] <- c("value", "freq")
ods$data <- "observed"
sds_ctgan <- data.frame(with(df_ctgan,table(bmi,useNA = "ifany")))
names(sds_ctgan)[1:2] <- c("value", "freq")
sds_ctgan$data <- "ctgan"
sds_datasynthesizer <- data.frame(with(df_datasynthesizer,table(bmi,useNA = "ifany")))
names(sds_datasynthesizer)[1:2] <- c("value", "freq")
sds_datasynthesizer$data <- "datasynthesizer"
sds_synthpop <- data.frame(with(df_synthpop,table(bmi,useNA = "ifany")))
names(sds_synthpop)[1:2] <- c("value", "freq")
sds_synthpop$data <- "synthpop"
df_compare_1_ds <- rbind(sds_datasynthesizer,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
mutate(value = as.factor(value),
sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data))
df_compare_1_ctgan <- rbind(sds_ctgan,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data))
df_compare_1_synthpop <- rbind(sds_synthpop,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data))
df_compare <- rbind(df_compare_1_ds, df_compare_1_ctgan)
df_graph <- ggplot(df_compare, aes(x = value, y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~sdg) +
theme_bw() +
scale_x_discrete(breaks = c("13","20","25","30","40","50","75",NA)) +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_ds_ctgan_bmi_1.pdf"), height = 4, width = 10)
df_compare <- rbind(df_compare_1_ds, df_compare_1_ctgan, df_compare_1_synthpop)
df_graph <- ggplot(df_compare, aes(x = value, y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~sdg) +
theme_bw() +
scale_x_discrete(breaks = c("13","20","25","30","40","50","75",NA)) +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_bmi_1.pdf"), height = 4, width = 10)
# Graph (wkabdur) ----
ods <- data.frame(with(df_ods,table(wkabdur,useNA = "ifany")))
names(ods)[1:2] <- c("value", "freq")
ods$data <- "observed"
sds_ctgan <- data.frame(with(df_ctgan,table(wkabdur,useNA = "ifany")))
names(sds_ctgan)[1:2] <- c("value", "freq")
sds_ctgan$data <- "ctgan"
sds_datasynthesizer <- data.frame(with(df_datasynthesizer,table(wkabdur,useNA = "ifany")))
names(sds_datasynthesizer)[1:2] <- c("value", "freq")
sds_datasynthesizer$data <- "datasynthesizer"
sds_synthpop <- data.frame(with(df_synthpop,table(wkabdur,useNA = "ifany")))
names(sds_synthpop)[1:2] <- c("value", "freq")
sds_synthpop$data <- "synthpop"
df_compare_1_ds <- rbind(sds_datasynthesizer,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(!is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nonmissing")
df_compare_2_ds <- rbind(sds_datasynthesizer,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "missing")
df_compare_1_ctgan <- rbind(sds_ctgan,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(!is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nonmissing")
df_compare_2_ctgan <- rbind(sds_ctgan,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "missing")
df_compare_1_synthpop <- rbind(sds_synthpop,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(!is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "nonmissing")
df_compare_2_synthpop <- rbind(sds_synthpop,ods)%>%
mutate(value = round(as.numeric(as.character(value))),0) %>%
group_by(data,value) %>%
summarise(total_1 = sum(freq)) %>%
group_by(data) %>%
mutate(total_2 = sum(total_1),
pct = total_1/total_2) %>%
ungroup() %>%
filter(is.na(value)) %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data),
type = "missing")
df_compare <- rbind(df_compare_1_ds, df_compare_1_ctgan, df_compare_2_ds, df_compare_2_ctgan)
df_graph <- ggplot(df_compare, aes(x = value, y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~type+sdg,scales = "free") +
theme_bw() +
scale_x_discrete(breaks = c("0","10","20","30","40","50","60", NA)) +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_ds_ctgan_wkabdur_1.pdf"), height = 4, width = 10)
df_compare <- rbind(df_compare_1_ds, df_compare_2_ds, df_compare_1_ctgan, df_compare_2_ctgan, df_compare_1_synthpop, df_compare_2_synthpop)
df_graph <- ggplot(df_compare, aes(x = value, y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~type+sdg,scales = "free") +
theme_bw() +
scale_x_discrete(breaks = c("0","10","20","30","40","50","60", NA)) +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
# axis.text.x = element_text(angle = 90, vjust = .5),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"compare_wkabdur_1.pdf"), height = 4, width = 10)
# Graph (education) ----
ods <- data.frame(with(df_ods,table(edu,useNA = "ifany")))
names(ods)[1:2] <- c("value", "freq")
ods$data <- "observed"
sds_ctgan <- data.frame(with(df_ctgan,table(edu,useNA = "ifany")))
names(sds_ctgan)[1:2] <- c("value", "freq")
sds_ctgan$data <- "ctgan"
sds_datasynthesizer <- data.frame(with(df_datasynthesizer,table(edu,useNA = "ifany")))
names(sds_datasynthesizer)[1:2] <- c("value", "freq")
sds_datasynthesizer$data <- "datasynthesizer"
sds_synthpop <- data.frame(with(df_synthpop,table(edu,useNA = "ifany")))
names(sds_synthpop)[1:2] <- c("value", "freq")
sds_synthpop$data <- "synthpop"
df_compare_ds <- rbind(sds_datasynthesizer,ods)%>%
group_by(data) %>%
mutate(total_1 = sum(freq)) %>%
ungroup() %>%
mutate(pct = freq/total_1) %>%
mutate(sdg = "datasynthesizer",
data = ifelse(data!="observed",yes = "synthetic", no = data)
)
df_compare_ctgan <- rbind(sds_ctgan,ods)%>%
group_by(data) %>%
mutate(total_1 = sum(freq)) %>%
ungroup() %>%
mutate(pct = freq/total_1) %>%
mutate(value = as.factor(value),
sdg = "ctgan",
data = ifelse(data!="observed",yes = "synthetic", no = data)
)
df_compare_synthpop <- rbind(sds_synthpop,ods)%>%
group_by(data) %>%
mutate(total_1 = sum(freq)) %>%
ungroup() %>%
mutate(pct = freq/total_1) %>%
mutate(value = as.factor(value),
sdg = "synthpop",
data = ifelse(data!="observed",yes = "synthetic", no = data)
)
df_compare <- rbind(df_compare_ds, df_compare_ctgan, df_compare_synthpop)
df_graph <- ggplot(df_compare, aes(x = value, y = pct, fill = data)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_wrap(~sdg,scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
# axis.title.x=element_blank(),
legend.key.width=unit(1, "cm"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"graph_frequency_compare_edu.pdf"), height = 4, width = 10)
# ROE ----
#nofriend
roc_univariate(df_ods,df_ctgan,21)
roc_univariate(df_ods,df_synthpop,21)
roc_univariate(df_ods,df_datasynthesizer,21)
df_nofriend_1 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,21),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,21))
df_nofriend_2 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,21),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,21),
synthpop = roc_univariate(df_ods,df_synthpop,21))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_nofriend_1)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_sd_ctgan_nofriend.tex"))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_nofriend_2)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_nofriend.tex"))
#bmi
roc_univariate(df_ods,df_ctgan,34)
roc_univariate(df_ods,df_synthpop,34)
roc_univariate(df_ods,df_datasynthesizer,34)
df_bmi_1 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,34),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,34))
df_bmi_2 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,34),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,34),
synthpop = roc_univariate(df_ods,df_synthpop,34))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_bmi_1)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_sd_ctgan_bmi.tex"))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_bmi_2)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_bmi.tex"))
#wkabdur
roc_univariate(df_ods,df_ctgan,27)
roc_univariate(df_ods,df_synthpop,27)
roc_univariate(df_ods,df_datasynthesizer,27)
df_wkabdur_1 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,27),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,27))
df_wkabdur_2 <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,27),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,27),
synthpop = roc_univariate(df_ods,df_synthpop,27))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_wkabdur_1)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_sd_ctgan_wkabdur.tex"))
# Print the data frame as a LaTeX table using xtable
latex_table <- xtable(df_wkabdur_2)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_wkabdur.tex"))
#edu
roc_univariate(df_ods,df_ctgan,5)
roc_univariate(df_ods,df_synthpop,5)
roc_univariate(df_ods,df_datasynthesizer,5)
df_edu <- data.frame(Measure = "ROE",
ctgan = roc_univariate(df_ods,df_ctgan,5),
datasynthesizer = roc_univariate(df_ods,df_datasynthesizer,5),
synthpop = roc_univariate(df_ods,df_synthpop,5))
# Compare all variables
df_frequency <- rbind(df_bmi_2,df_nofriend_2,df_wkabdur_2,df_edu)
df_frequency$variable <- c("Number of friends", "BMI", "Work abroad duration","Education")
df_frequency$Measure <- NULL
df_frequency <- df_frequency %>%
select(variable,everything())
latex_table <- xtable(df_frequency)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_frequency.tex"))
df_frequency_long <- df_frequency %>%
pivot_longer(!c("variable"))
df_frequency_long
df_graph <- ggplot(df_frequency_long, aes(x = name, y = value)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~variable) +
ylab("Ratio of estimates (ROE)") +
scale_y_continuous(limits = c(0,1.1), breaks = seq(0,1,.25)) +
theme_bw() +
geom_text(aes(label = round(value,3)), vjust = -.5) + # vjust adjusts vertical position of the text
theme(panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"graph_compare_roe.pdf"), height = 4, width = 10)
df_frequency_long
#bmi
roc_univariate(df_ods,df_ctgan,34)
roc_univariate(df_ods,df_synthpop,34)
roc_univariate(df_ods,df_datasynthesizer,34)
df_frequency <- rbind(df_bmi_2,df_edu,df_nofriend_2,df_wkabdur_2)
df_frequency$variable <- c("BMI","Education", "Number of friends", "Work abroad duration",)
df_frequency <- rbind(df_bmi_2,df_edu,df_nofriend_2,df_wkabdur_2)
df_frequency$variable <- c("BMI","Education", "Number of friends", "Work abroad duration")
df_frequency$Measure <- NULL
df_frequency <- df_frequency %>%
select(variable,everything())
latex_table <- xtable(df_frequency)
print.xtable(latex_table,
include.rownames = FALSE,
sanitize.text.function = identity,
floating = FALSE,
booktabs = TRUE,
file = paste0(tables,"table_compare_roe.tex"))
df_frequency_long <- df_frequency %>%
pivot_longer(!c("variable"))
df_frequency_long
df_graph <- ggplot(df_frequency_long, aes(x = name, y = value)) +
geom_bar(position = position_dodge(width = .9), stat = "identity") +
facet_nested_wrap(~variable) +
ylab("Ratio of estimates (ROE)") +
scale_y_continuous(limits = c(0,1.1), breaks = seq(0,1,.25)) +
theme_bw() +
geom_text(aes(label = round(value,3)), vjust = -.5) + # vjust adjusts vertical position of the text
theme(panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.line.y = element_line(color="black", linewidth=.5),
axis.line.x = element_line(color="black", linewidth=.5)
)
df_graph
ggsave(plot = df_graph, paste0(graphs,"graph_compare_roe.pdf"), height = 4, width = 10)
